"use strict";angular.module("giftableApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase","firebase.ref","firebase.auth","angularModalService","ImageCropper"]),angular.module("giftableApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("firebase.config",[]).constant("FBURL","https://giftable.firebaseio.com").constant("SIMPLE_LOGIN_PROVIDERS",["password"]).constant("loginRedirectPath","/login"),angular.module("firebase.ref",["firebase","firebase.config"]).factory("Ref",["$window","FBURL",function(a,b){return new a.Firebase(b)}]),angular.module("giftableApp").controller("ChatCtrl",["$scope","Ref","$firebaseArray","$timeout",function(a,b,c,d){function e(b){a.err=b,d(function(){a.err=null},5e3)}a.messages=c(b.child("messages").limitToLast(10)),a.messages.$loaded()["catch"](e),a.addMessage=function(b){b&&a.messages.$add({text:b})["catch"](e)}}]),angular.module("giftableApp").filter("reverse",function(){return function(a){return angular.isArray(a)?a.slice().reverse():[]}}),function(){angular.module("firebase.auth",["firebase","firebase.ref"]).factory("Auth",["$firebaseAuth","Ref",function(a,b){return a(b)}])}(),angular.module("giftableApp").controller("NavCtrl",["$scope","$location",function(a,b){a.isCurrentPath=function(a){return b.path()===a}}]),angular.module("giftableApp").controller("LoginCtrl",["$scope","Auth","$location","$q","Ref","$timeout",function(a,b,c,d,e,f){function g(a){return h(a.substr(0,a.indexOf("@"))||"")}function h(a){a+="";var b=a.charAt(0).toUpperCase();return b+a.substr(1)}function i(){c.path("/people")}function j(b){a.err=b}a.passwordLogin=function(c,d){a.err=null,b.$authWithPassword({email:c,password:d},{rememberMe:!0}).then(i,j)},a.createAccount=function(c,h,k){function l(a){var b=e.child("users",a.uid),h=d.defer();return b.set({email:c,name:g(c)},function(a){f(function(){a?h.reject(a):h.resolve(b)})}),h.promise}a.err=null,h?h!==k?a.err="Passwords do not match":b.$createUser({email:c,password:h}).then(function(){return b.$authWithPassword({email:c,password:h},{rememberMe:!0})}).then(l).then(i,j):a.err="Please enter a password"}}]),angular.module("giftableApp").controller("AccountCtrl",["$scope","user","Auth","Ref","$firebaseObject","$timeout",function(a,b,c,d,e,f){function g(a){i(a,"danger")}function h(a){i(a,"success")}function i(b,c){var d={text:b+"",type:c};a.messages.unshift(d),f(function(){a.messages.splice(a.messages.indexOf(d),1)},1e4)}a.user=b,a.logout=function(){c.$unauth()},a.messages=[];var j=e(d.child("users/"+b.uid));j.$bindTo(a,"profile"),a.changePassword=function(b,d,e){a.err=null,b&&d?d!==e?g("Passwords do not match"):c.$changePassword({email:j.email,oldPassword:b,newPassword:d}).then(function(){h("Password changed")},g):g("Please enter all fields")},a.changeEmail=function(b,d){a.err=null,c.$changeEmail({password:b,newEmail:d,oldEmail:j.email}).then(function(){j.email=d,j.$save(),h("Email changed")})["catch"](g)}}]),angular.module("giftableApp").directive("ngShowAuth",["Auth","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){b(function(){d.toggleClass("ng-cloak",!a.$getAuth())},0)}d.addClass("ng-cloak"),a.$onAuth(e),e()}}}]),angular.module("giftableApp").directive("ngHideAuth",["Auth","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){b(function(){d.toggleClass("ng-cloak",!!a.$getAuth())},0)}d.addClass("ng-cloak"),a.$onAuth(e),e()}}}]),angular.module("giftableApp").config(["$routeProvider","SECURED_ROUTES",function(a,b){a.whenAuthenticated=function(c,d){return d.resolve=d.resolve||{},d.resolve.user=["Auth",function(a){return a.$requireAuth()}],a.when(c,d),b[c]=!0,a}}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).whenAuthenticated("/chat",{templateUrl:"views/chat.html",controller:"ChatCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).whenAuthenticated("/person/:id",{templateUrl:"views/person.html",controller:"PersonCtrl"}).whenAuthenticated("/account",{templateUrl:"views/account.html",controller:"AccountCtrl"}).whenAuthenticated("/people",{templateUrl:"views/people.html",controller:"PeopleCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","Auth","SECURED_ROUTES","loginRedirectPath",function(a,b,c,d,e){function f(a){!a&&g(b.path())&&b.path(e)}function g(a){return d.hasOwnProperty(a)}c.$onAuth(f),a.$on("$routeChangeError",function(a,c,d,f){"AUTH_REQUIRED"===f&&b.path(e)})}]).constant("SECURED_ROUTES",{}),angular.module("giftableApp").controller("PeopleCtrl",["$scope","Ref","$firebaseArray","$timeout","$location","ModalService",function(a,b,c,d,e,f){function g(b){a.err=b,d(function(){a.err=null},5e3)}var h=b.getAuth();a.people=c(b.child("person").orderByChild("created_by").equalTo(h.uid)),a.people.$loaded()["catch"](g),a.noPicture=!1,a.addPerson=function(b){b&&a.people.$add({first_name:b.first_name,last_name:b.last_name,picture:b.picture,created_by:h.uid})["catch"](g)},a.goToPerson=function(a){a&&e.path("/person/"+a)},a.addGiftee=function(){f.showModal({templateUrl:"views/addGiftee.html",controller:"ModalCtrl"}).then(function(b){b.element.modal(),b.close.then(function(b){a.formData=b,"Cancel"!==a.formData&&a.people.$add({first_name:b.first_name,last_name:b.last_name,picture:b.picture,created_by:h.uid})["catch"](g)})})}}]),angular.module("giftableApp").controller("PersonCtrl",["$scope","$routeParams","PersonSvc","Ref","$firebaseArray","ModalService","$timeout","$location",function(a,b,c,d,e,f,g,h){function i(){h.path("/people")}function j(b){a.err=b,g(function(){a.err=null},5e3)}var k=d.getAuth();a.id=b.id,a.person=new c(a.id),a.people=a.people=e(d.child("person").orderByChild("created_by").equalTo(k.uid)),a.gifts=e(d.child("person/"+a.id+"/gifts")),a.events=e(d.child("person/"+a.id+"/events")),a.deleteGiftee=function(){f.showModal({templateUrl:"views/deleteGiftee.html",controller:"ModalCtrl"}).then(function(b){b.element.modal(),b.close.then(function(b){a.formData=b,"Delete"===a.formData&&a.person.created_by===k.uid&&a.people.$remove(a.people.$getRecord(a.id)).then(function(){i()})["catch"](j)})})},a.addGift=function(){f.showModal({templateUrl:"views/addGift.html",controller:"ModalCtrl"}).then(function(b){b.element.modal(),b.close.then(function(b){a.formData=b,"Cancel"!==a.formData&&a.gifts.$add({title:b.title,description:b.description,cost:b.cost,picture:b.picture,interest_level:b.interest_level,status:"New",createdAt:Date.now()/1e3})["catch"](j)})})},a.addEvent=function(){f.showModal({templateUrl:"views/addEvent.html",controller:"ModalCtrl"}).then(function(b){b.element.modal(),b.close.then(function(b){a.formData=b,"Cancel"!==a.formData&&a.events.$add({title:b.title,description:b.description,event_date:"1408295376000",created_at:Date.now()/1e3})["catch"](j)})})},a.isCreator=function(){return a.person.created_by===k.uid?!0:!1}}]),angular.module("giftableApp").service("PersonSvc",["$firebaseObject",function(a){var b=new Firebase("https://giftable.firebaseio.com").child("person");return function(c){return a(b.child(c))}}]),angular.module("giftableApp").controller("ModalCtrl",["$scope","close",function(a,b){a.close=function(a){b(a,500)},a.imageCropStep="1"}]);